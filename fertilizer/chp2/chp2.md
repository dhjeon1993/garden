# 테스트

> 테스트란 개발자가 마음 편하게 잠자리에 들 수 있게 해주는 것
> _(켄트 백)_


## 목차
1. **테스트란 무엇인가?**
1. **테스트가 필요한 이유**
1. **테스트 활용 전략**
	1. **테스트를 진행하는 방법**
	1. **작은 단위의 테스트(Unit test)**
	1. **자동수행 테스트 코드**
	1. **효율적인 테스트를 위한 하나의 방법**
	1. **올바른 테스트를 위한 조건**
1. **테스팅 프레임워크**
	1. **xUnit**
	1. **JUnit** 
		1. **JUnit 테스트 수행 방식**
		1. **JUnit 테스트의 특징**
	1. **스프링 테스트**
		1. **JUnit에서의 애플리케이션 컨텍스트**
		1. **DI와 테스트**
		1. **DI를 이용한 테스트 방법**
1. **버그 테스트**
	1. **버그 테스트의 필요성과 장점**
1. **TDD(Test Driven Development), 테스트 주도 개발**
	1. **TDD의 장점**
	1. **TDD의 단점**
	1. **TDD의 법칙 세 가지**

---

## 테스트란 무엇인가?
 **테스트란 개발자가 의도했던 대로 코드가 정확히 동작하는지 확인하는 작업이다.** 코드가 정확히 동작하지 않는다면 아무 쓸모가 없기 때문에 테스트는 개발에서 중요한 역할을 담당한다. 따라서 테스트 없는 개발은 존재하지 않는다. 심지어 우리가 코드를 작성하는 것 조차 머릿속으로 일련의 테스트를 수행하며 진행되는 것이다. 
 테스트가 개발에서 중요한 부분을 담당하는 만큼, 우리는 **테스트 자체를 효과적으로 수행하는 방법**을 알아야한다. 

## 테스트가 필요한 이유
테스트란 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지를 확인해서, 만든 코드를 확신할 수 있게 해주는 작업이다.
또한 테스트의 결과가 원하는 대로 나오지 않는 경우에는 코드나 설계에 결함이 있음을 알 수 있다.
이를 통해 코드의 결함을 제거해가는 작업, 일명 디버깅을 거치게 되고, 결국 최종적으로 테스트가 성공하면 모든 결함이 제거됐다는 확신을 얻을 수 있다.

테스트는 유연성, 유지보수성, 재사용성을 제공한다.

## 테스트 활용 전략
### 테스트를 진행하는 방법
#### 프로그램의 엔트리 포인트에서 테스트
테스트를 하기위한 가장 쉬운 방법은 어떤 언어로 작성한 프로그램이던 프로그램의 시작지점(엔트리 포인트)이 있다.
엔트리 포인트에서 테스트를 위한 작업을 진행하면 별도의 라이브러리나 환경설정이 필요없이 테스트가 가능하다.

#### 웹을 통한 테스트의 단점
* MVC구조의 각 계층을 모두 구현해야만 테스트가 가능하다.
* 테스트를 하는 중에 에러가 나거나 문제가 발생하면 정확한 위치를 찾기 힘들다.
* 실제 테스트할 모듈을 집중적으로 테스트할 수 없다.
* 서버의 설정 상태까지 테스트에 영향을 줄 수 있다.

=> 오류가 있을 때 빠르고 정확하게 대응하기가 힘들다.
### 작은 단위의 테스트(Unit test)
 **테스트에도 관심사의 분리라는 원리를 적용**해야 한다. 한 번에 하나의 관심사에 대해 테스트를 수행하면 **오류의 원인을 빠르게 파악하고 수정**할 수 있다. 반면에 테스트의 단위가 크다면 수행 과정도 복잡할 뿐 아니라 오류의 원인을 빠르게 짚어내기 힘들다. 따라서 큰 단위의 테스트는 작은 단위의 테스트를 수행한 뒤 진행되어야한다.
 여기서 **작은 단위의 테스트를 일반적으로 단위 테스트**라고 부르며, 단위의 크기나 범위가 어느 정도인지는 딱 정해진 바는 없다.

작은 단위의 테스트를 하는 이유는 작성한 코드가 의도한 대로 동작하는지를 개발자 스스로가 빠르게 확인받기 위함이다.

**작은 단위의 범위란**
충분히 하나의 관심에 집중해서 효율적으로 테스트할 만한 범위의 단위.
일반적으로 단위는 작을수록 좋다.

### 자동수행 테스트 코드

 **테스트가 코드를 통해 진행**되도록 해야한다. 코드를 통해 테스트를 진행하면 언제나 테스트를 **반복하여 진행할 수 있으며, 빠르게 수행**된다는 장점이 있다. 반면에 사람의 수작업을 통해 테스트가 진행되면 번거롭고 시간이 오래 걸린다. 이런 불편함은 테스트를 꼼꼼하게 하려는 마음을 접게 만들기도 한다.

#### 테스트 검증의 자동화

 테스트를 수행할 때, 코드의 결과를 검증하는 것도 사람의 노력이 필요하다. 하지만 테스트는 오직 성공과 실패 두 가지의 결과만을 갖는다. 따라서 **코드의 결과를 검증하는 작업도 테스트 코드에 포함시켜 테스트의 결과는 성공과 실패**만을 갖게 만들어야 한다.

#### 자동수행 테스트의 장점

* 자주 반복할 수 있다.
* 코드가 변경되었을 때, 테스트 코드를 수정하지 않는다.
* 기능이 정상적으로 동작하는지를 언제든지 손쉽게 확인할 수 있다.

## 효율적인 테스트를 위한 하나의 방법

1. 테스트를 하기 위해 주어진 조건을 확인한다. (Given)
1. 테스트할 기능이 언제 일어나는지를 확인한다. (When)
1. 테스트 결과가 무엇인지 확인한다. (Then)

## 올바른 테스트를 위한 조건

### 빠르게 수행되어야 한다.
테스트가 느리면 자주 돌리기 힘들고, 자주 돌리지 않으면 초반에 문제를 찾아내 고치지 못하며 코드를 마음껏 정리하지도 못한다.
결국 코드 품질이 망가지기 시작한다.

### 독립적이어야 한다.
각 테스트는 서로 의존하면 안 된다. 
한 테스트가 다른 테스트의 준비 조건이 되면 안 된다.
또한 각 테스트는 실행 순서에 영향을 받아서는 안 된다.
서로 의존하는 테스트는 하나의 테스트가 실패하면 의존하는 다른 테스트도 연달아 실패하기 때문에 어디서 실패하는지를 정확하게 진단하기 힘들다.

### 반복할 수 있어야 한다.(동일한 결과를 보장해야 한다.)
잘 작성된 테스트 코드는 테스트를 수행할 때 어떤 환경에서든 항상 같은 결과를 보장할 수 있도록 작성된다.
테스트가 수행될 때의 환경에 따라 결과가 바뀐다면 해당 테스트는 다시 사용하지 못하는 일회성 테스트가 된다.
개발자가 테스트하기 전에 환경을 설정해야 한다면 자주 테스트를 수행하기에 부담스럽다.
따라서 각 테스트는 자동으로 테스트하기에 적절한 환경이 되도록 작성해야 하며 동일한 결과를 보장해야 한다.

### 자가검증을 해야한다.
테스트 결과는 항상 성공 또는 실패가 되어야 한다.
테스트가 스스로 성공과 실패 여부를 확인하지 않는다면 결과에 주관적인 판단이 들어가게 되며 일일히 결과 여부를 확인하는 지루한 수작업이 된다.



## 테스팅 프레임워크
main() 메소드를 이용한 테스트 작성 방법은 애플리케이션 규모가 커지고 테스트 개수가 많아지면 테스트를 수행하는 일이 점점 부담이 된다.
따라서 일정한 패턴을 가진 테스트를 만들 수 있고, 많은 테스트를 간단히 실행시킬 수 있으며, 테스트 결과를 종합해서 볼 수 있고,테스트가 실패한 곳을 빠르게 찾을 수 있는 기능을 갖춘 테스트 지원 도구와 그에 맞는 테스트 작성 방법이 필요하다.
###	xUnit
 xUnit은 **테스팅 프레임워크의 시초**이다. 켄트 벡이 고안한 것으로 sUnit에 처음 적용되었다. 현재 많은 언어로 포팅되어 OOUnit이라는 이름으로 존재한다.
###	JUnit 
자바에는 단순하면서도 실용적인 테스트를 위한 도구가 여러 가지 존재한다.
그 중에서도 프로그래머를 위한 자바 테스팅 프레임워크라고 불리는 JUnit은 유명한 테스트 지원 도구이다.
JUnit은 이름 그대로 자바로 단위 테스트를 만들 때 유용하게 쓸 수 있다.

> 픽스처(Fixture)
> 
> 테스트를 수행하는 데 필요한 정보나 오브젝트를 픽스처라고 한다.

####  JUnit 테스트 수행 방식
1. 테스트 클래스에서 `@Test`가 붙은 public이고 void형이며 파라미터가 없는 테스트 메소드를 모두 찾는다.
1. 테스트 클래스의 오브젝트를 하나 만든다.
1. `@Before`가 붙은 메소드가 있으면 실행한다.
1. `@Test`가 붙은 메소드를 하나 호출하고 테스트 결과를 저장해둔다.
1. `@After`가 붙은 메소드가 있으면 실행한다.
1. 나머지 테스트 메소드에 대해 2~5번을 반복한다.
1. 모든 테스트의 결과를 종합해서 돌려준다.
####  JUnit 테스트의 특징
* JUnit은 테스트 메소드를 실행할 때마다 새로운 오브젝트를 만든다.
* JUnit은 각 테스트 메소드의 실행 순서가 정해져 있지 않다.

=> 각 테스트가 서로 영향을 주지 않고 독립적으로 실행됨을 확실히 보장해주기 위함.

### 스프링 테스트
스프링의 핵심 기능 중 하나인 스프링 테스트 모듈도 JUnit을 이용한다.
따라서 스프링의 기능을 익히기 위해서라도 JUnit은 꼭 사용할 줄 알아야 한다.
대부분의 자바 IDE는 JUnit 테스트를 손쉽게 실행할 수 있는 JUnit 테스트 지원 기능을 내장하고 있어서 더욱 편리하게 JUnit 테스트를 만들고 활용할 수 있게 해준다.
####  JUnit에서의 애플리케이션 컨텍스트
JUnit은 테스트를 수행할 때 매번 새로운 오브젝트를 만든다고 했다.
때문에 애플리케이션 컨텍스트도 매번 새로 생성된다.
하지만 애플리케이션 컨텍스트는 여러 오브젝트가 참조해야 하며 크기가 큰 오브젝트이다.
또한 애플리케이션 컨텍스트는 싱글톤으로 동작하기 때문에 상태를 가지지 않는다.
결국 매번 새로 애플리케이션 컨텍스트를 만드는 것은 비효율적이며 테스트에 상당한 부하를 준다.

따라서 JUnit에서는 애플리케이션 컨텍스트를 지원하는 기능을 제공한다.
* `@RunWith`는 JUnit 프레임워크의 테스트 실행 방법을 확장할 때 사용하는 어노테이션이다.
`SpringJUnit4ClassRunner`라는 JUnit용 테스트 컨텍스트 프레임워크 확장 클래스를 지정해주면 JUnit이 테스트를 진행하는 중에 테스트가 사용할 애플리케이션 컨텍스트를 만들고 관리하는 작업을 진행해준다.
* `@ContextConfiguration`은 자동으로 만들어줄 애플리케이션 컨텍스트의 설정파일 위치를 지정하는 것이다.
#### DI와 테스트
테스트에서도 DI를 사용해야 한다.
1. 소프트웨어 개발에서 절대로 바뀌지 않는 것은 없기 때문이다.
당장에는 클래스를 바꿔서 사용할 계획이 전혀 없더라도, 언젠가 변경이 필요한 상황이 닥쳤을 때 수정에 들어가는 시간과 비용의 부담을 줄여줄 수 있다면, 인터페이스를 사용하고 DI를 적용하는 작은 수고를 하지 않을 이유가 없다.
1. 클래스의 구현 방식은 바뀌지 않는다고 하더라도 인터페이스를 두고 DI를 적용하게 해두면 다른 차원의 서비스 기능을 도입할 수 있기 때문이다.
1. 효율적인 테스트를 손쉽게 만들기 위해서라도 DI를 적용해야 한다.
테스트를 잘 활용하려면 자동으로 실행 가능하며 빠르게 동작하도록 테스트 코드를 만들어야 한다.
그러기 위해서는 가능한 한 작은 단위의 대상에 국한해서 테스트해야 한다.
DI는 테스트가 작은 단위의 대상에 대해 독립적으로 만들어지고 실행되게 하는 데 중요한 역할을 한다.
#### DI를 이용한 테스트 방법
1.  컨테이너 없는 DI 테스트
    *   항상 스프링 컨테이너 없이 테스트할 수 있는 방법을 가장 우선적으로 고려해야 한다.
        이 방법이 테스트 수행 속도가 가장 빠르고 테스트 자체가 간결하다.
        테스트를 위해 필요한 오브젝트의 생성과 초기화가 단순하다면 이 방법을 가장 먼저 고려해야 한다.
1.  스프링 컨테이너를 이용한 DI 테스트
    *   여러 오브젝트와 복잡한 의존관계를 갖고 있는 오브젝트를 테스트해야 할 경우에 사용하면 편리하다.
1.  별도의 테스트용 스프링 컨테이너 설정파일을 이용하는 테스트
    *   보통 개발환경과 테스트환경, 운영환경이 차이가 있기 때문에 각각 다른 설정파일을 만들어 사용하는 경우가 일반적이다.

## 버그 테스트
버그 테스트란 코드에 오류가 있을 때 그 오류를 가장 잘 드러내줄 수 있는 테스트를 말한다.

버그 테스트는 일단 실패하도록 만들어야 한다.
버그가 원인이 되서 테스트가 실패하는 코드를 만드는 것이다.
그러고 나서 버그 테스트가 성공할 수 있도록 코드를 수정한다.
테스트가 성공하면 버그는 해결된 것이다.

### 버그 테스트의 필요성과 장점
*   테스트의 완성도를 높여준다.
*   버그의 내용을 명확하게 분석하게 해준다.
*   기술적인 문제를 해결하는 데 도움이 된다.

## TDD(Test Driven Development), 테스트 주도 개발
 개발이 이루어진 후 테스트 케이스를 작성하고 테스트하는 방식과는 달리, **테스트 케이스를 먼저 작성 후, 테스트 케이스에 맞추어 실제 개발을 진행하는 개발 방법론**을 말한다. **"실패한 테스트를 성공시키기 위한 목적이 아닌 코드는 만들지 않는다."**는 기본 원칙을 갖는다.

### TDD의 장점
*   결함이 줄어든다.
*   코드 복잡도가 떨어진다.

### TDD의 단점
*   기존 개발 방식과 달라 적용하기 어렵다.

>   RED
>
>   실패하는 테스트 만들기.

>   GREEN
> 
>   테스트에 통과할 만한 작은 코드를 작성하기.

>   REFACTOR
>
>   반복되는 코드, 긴 메소드, 큰 클래스, 긴 매개변수 목록 등등 코드를 좀 더 효율적으로 바꾸기.

### TDD의 법칙 세 가지
1.  실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
1.  컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
1.  현재 실패하는 테스트를 통과할 정도로만 실제 코드를 구현한다.
